import{_ as S}from"./preload-helper.101896b7.js";import{u as ce}from"./vue-i18n.cjs.2a00fe88.js";import{L as B}from"./storage.b628b270.js";import{h as A,aH as ue,r as I,ap as V,K as E,o as fe,a9 as s,ac as _e,j as x,k as $,l as P,D as o,x as t,u as p,F as ge,Z as be,B as d,C as m,y as ye,v as N}from"./vue.bd0669ce.js";import{a as we}from"./index.88f3b739.js";import{a as j}from"./formatTime.b2c6dda0.js";import{a as xe}from"./data.65169b13.js";import{p as ve}from"./parser.ff2a5d82.js";import{J as Te}from"./index.f64fca3a.js";import{ay as he}from"./index.e8f4f9cf.js";import{_ as De}from"./_plugin-vue_export-helper.c27b6911.js";import"./_commonjsHelpers.35101cd5.js";import"./request.c46845dc.js";import"./index.d2f052aa.js";import"./index.aa7cec2e.js";import"./themeConfig.cb88f033.js";import"./index.510ba4c9.js";import"./header.9390c1c5.js";import"./index.ee56f1f7.js";const Ie={class:"system-role-container layout-padding"},Ee={class:"system-role-padding layout-padding-auto layout-padding-view"},je={class:"system-user-search mb15"},Ce=A({name:"systemRole"}),ke=A({...Ce,setup(Re){const M=ue(),{t:n}=ce(),v=we(),T=I(),L=V(()=>S(()=>import("./dialog.6b315746.js"),["assets/dialog.6b315746.js","assets/preload-helper.101896b7.js","assets/vue.bd0669ce.js","assets/vue-i18n.cjs.2a00fe88.js","assets/_commonjsHelpers.35101cd5.js","assets/data.65169b13.js","assets/index.510ba4c9.js","assets/request.c46845dc.js","assets/storage.b628b270.js","assets/index.d2f052aa.js","assets/index.aa7cec2e.js","assets/themeConfig.cb88f033.js","assets/index.f64fca3a.js","assets/index.e8f4f9cf.js","assets/index.ee56f1f7.js","assets/header.9390c1c5.js","assets/index.88f3b739.js","assets/_plugin-vue_export-helper.c27b6911.js","assets/dialog.b109239a.css"])),J=V(()=>S(()=>import("./drawer.33899243.js"),["assets/drawer.33899243.js","assets/preload-helper.101896b7.js","assets/vue.bd0669ce.js","assets/vue-i18n.cjs.2a00fe88.js","assets/_commonjsHelpers.35101cd5.js","assets/index.63fac81c.js","assets/request.c46845dc.js","assets/storage.b628b270.js","assets/index.d2f052aa.js","assets/index.aa7cec2e.js","assets/themeConfig.cb88f033.js","assets/index.f64fca3a.js","assets/index.e8f4f9cf.js","assets/index.ee56f1f7.js","assets/header.9390c1c5.js","assets/index.88f3b739.js","assets/formatTime.b2c6dda0.js","assets/data.65169b13.js","assets/index.510ba4c9.js","assets/parser.ff2a5d82.js"])),C=I(),w=I(),k=E({list:[]}),i=E({form:{appId:"",namespaceId:B.get("nid"),name:""},rules:{}}),r=E({tableData:{data:[],total:0,loading:!1,param:{pageNum:1,pageSize:20}}}),u=async()=>{r.tableData.loading=!0;let a=await v.getList({namespaceId:B.get("nid"),appId:i.form.appId,name:i.form.name,page:r.tableData.param.pageNum,size:r.tableData.param.pageSize});r.tableData.data=[],a.list.forEach(function(e){r.tableData.data.push({id:e.id,namespaceId:e.namespaceId,appId:e.appId,appName:e.appName,workflowId:e.workflowId,name:e.name,description:e.description,processorType:e.processorType,processorInfo:e.processorInfo,shellProcessorType:e.shellProcessorType,shellProcessorInfo:e.shellProcessorInfo,kettleProcessorType:e.kettleProcessorType,kettleProcessorInfo:e.kettleProcessorInfo,shardingParams:e.shardingParams,executeType:e.executeType,paramsType:e.paramsType,params:e.params,extendParamsType:e.extendParamsType,extendParams:e.extendParams,timeExpressionType:e.timeExpressionType,timeExpression:e.timeExpressionType==="oneTime"?j(e.timeExpression):e.timeExpression,nextExecuteTime:U(e.timeExpressionType,e.timeExpression),timeExpressionValue:e.timeExpressionValue,executeStrategy:e.executeStrategy,failRetryTimes:e.failRetryTimes,failRetryInterval:e.failRetryInterval,executeTimeout:e.executeTimeout,concurrency:e.concurrency,status:e.status===1,createTime:j(e.createTime)})}),r.tableData.total=a.total,setTimeout(()=>{r.tableData.loading=!1},500)},U=(a,e)=>{if(a=="cron"){var _=ve.parseExpression(e.toString());return j(_.next().getTime()/1e3)}if(a=="oneTime")return"-"},O=async(a,e)=>{const _=a?1:2;await v.updateStatus({id:e.id,status:_})},R=a=>{!a||a.validate(e=>{if(e)u();else return!1})},F=()=>{i.form.name="",i.form.appId="",u()},H=(a,e)=>{if(a==="execute"){C.value.openDialog(e);return}if(a==="copy"){w.value.openDrawer("copy",i.form.appId,e);return}if(a==="delete"){G(e);return}},q=a=>{w.value.openDrawer(a,i.form.appId)},K=(a,e)=>{w.value.openDrawer(a,i.form.appId,e)},Z=a=>{M.push({path:"/admin/job-instance/list",query:{id:a.id,appId:a.appId}})},G=a=>{Te.confirm(n("message.job.job.deleteTitle")+`(${a.name})?`,n("message.commonMsg.tip"),{confirmButtonText:n("message.commonBtn.confirm"),cancelButtonText:n("message.commonBtn.cancel"),type:"warning"}).then(async()=>{await v.delete({id:a.id}),await u(),he.success(n("message.commonMsg.deleteSuccess"))}).catch(()=>{})},Q=a=>{r.tableData.param.pageSize=a,u()},W=a=>{r.tableData.param.pageNum=a,u()};return fe(async()=>{k.list=await xe(),await u()}),(a,e)=>{const _=s("el-option"),X=s("el-select"),z=s("el-form-item"),h=s("el-col"),Y=s("el-input"),ee=s("ele-Search"),g=s("el-icon"),b=s("el-button"),oe=s("ele-RefreshRight"),ae=s("ele-FolderAdd"),y=s("el-row"),te=s("el-form"),c=s("el-table-column"),le=s("el-switch"),se=s("ele-Edit"),ne=s("ele-Monitor"),D=s("el-dropdown-item"),re=s("el-dropdown-menu"),pe=s("el-dropdown"),me=s("el-table"),ie=s("el-pagination"),de=_e("loading");return x(),$("div",Ie,[P("div",Ee,[P("div",je,[o(te,{ref_key:"tableSearchRef",ref:T,model:i.form,rules:i.rules},{default:t(()=>[o(y,null,{default:t(()=>[o(h,{xs:8,sm:12,md:8,lg:6,xl:4,class:"mb20"},{default:t(()=>[o(z,{label:p(n)("message.app.name"),prop:"appName"},{default:t(()=>[o(X,{modelValue:i.form.appId,"onUpdate:modelValue":e[1]||(e[1]=l=>i.form.appId=l),filterable:"",placeholder:p(n)("message.commonMsg.all"),size:"default",style:{width:"90%"}},{default:t(()=>[(x(!0),$(ge,null,be(k.list,l=>(x(),N(_,{key:l.id,label:l.label,value:l.id,onClick:e[0]||(e[0]=f=>R(T.value))},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),o(h,{xs:8,sm:12,md:8,lg:6,xl:4,class:"mb20"},{default:t(()=>[o(z,{label:p(n)("message.job.job.name"),prop:"name"},{default:t(()=>[o(Y,{modelValue:i.form.name,"onUpdate:modelValue":e[2]||(e[2]=l=>i.form.name=l),size:"default",style:{width:"95%"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),o(h,{xs:8,sm:12,md:8,lg:6,xl:4,class:"mb20"},{default:t(()=>[o(b,{size:"default",type:"primary",class:"ml10",onClick:e[3]||(e[3]=l=>R(T.value))},{default:t(()=>[o(g,null,{default:t(()=>[o(ee)]),_:1}),d(" "+m(a.$t("message.commonBtn.query")),1)]),_:1}),o(b,{size:"default",type:"primary",class:"ml10",onClick:e[4]||(e[4]=l=>F())},{default:t(()=>[o(g,null,{default:t(()=>[o(oe)]),_:1}),d(" "+m(a.$t("message.commonBtn.reset")),1)]),_:1}),o(b,{size:"default",type:"success",class:"ml10",onClick:e[5]||(e[5]=l=>q("add"))},{default:t(()=>[o(g,null,{default:t(()=>[o(ae)]),_:1}),d(" "+m(a.$t("message.commonBtn.add")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),ye((x(),N(me,{data:r.tableData.data,style:{width:"100%"}},{default:t(()=>[o(c,{prop:"appName",label:p(n)("message.job.job.application"),"show-overflow-tooltip":""},null,8,["label"]),o(c,{prop:"name",label:p(n)("message.job.job.name"),"show-overflow-tooltip":""},null,8,["label"]),o(c,{prop:"processorInfo",label:p(n)("message.job.job.processorInfo"),"show-overflow-tooltip":""},null,8,["label"]),o(c,{prop:"executeType",label:p(n)("message.job.job.processorAndExecuteType"),"show-overflow-tooltip":""},{default:t(l=>[o(y,null,{default:t(()=>[d("["+m(l.row.processorType)+"] "+m(l.row.executeType),1)]),_:2},1024)]),_:1},8,["label"]),o(c,{prop:"timeExpression",label:p(n)("message.job.job.expressionAndType"),"show-overflow-tooltip":""},{default:t(l=>[o(y,{style:{"font-weight":"bold"}},{default:t(()=>[d(m(l.row.timeExpressionType),1)]),_:2},1024),o(y,null,{default:t(()=>[d(m(l.row.timeExpression),1)]),_:2},1024)]),_:1},8,["label"]),o(c,{prop:"nextExecuteTime",label:p(n)("message.job.job.nextExecuteTime"),"show-overflow-tooltip":""},{default:t(l=>[o(y,null,{default:t(()=>[d(m(l.row.nextExecuteTime),1)]),_:2},1024)]),_:1},8,["label"]),o(c,{prop:"status",label:p(n)("message.job.job.status"),"show-overflow-tooltip":""},{default:t(l=>[o(le,{modelValue:l.row.status,"onUpdate:modelValue":f=>l.row.status=f,class:"ml-2",size:"default",onChange:f=>O(f,l.row),style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"]),o(c,{prop:"createTime",label:p(n)("message.job.job.createTime"),"show-overflow-tooltip":""},null,8,["label"]),o(c,{label:p(n)("message.commonMsg.operation"),width:"360"},{default:t(l=>[o(b,{type:"primary",size:"default",onClick:f=>K("update",l.row)},{default:t(()=>[o(g,null,{default:t(()=>[o(se)]),_:1}),d(" "+m(a.$t("message.commonBtn.update")),1)]),_:2},1032,["onClick"]),o(b,{type:"success",size:"default",onClick:f=>Z(l.row)},{default:t(()=>[o(g,null,{default:t(()=>[o(ne)]),_:1}),d(" "+m(a.$t("message.commonBtn.instance")),1)]),_:2},1032,["onClick"]),o(pe,{"split-button":"",type:"info",size:"default",style:{"margin-left":"12px"},onCommand:f=>H(f,l.row)},{dropdown:t(()=>[o(re,null,{default:t(()=>[o(D,{command:"execute"},{default:t(()=>[d(m(a.$t("message.job.job.executeOnce")),1)]),_:1}),o(D,{command:"copy"},{default:t(()=>[d(m(a.$t("message.commonBtn.copy")),1)]),_:1}),o(D,{command:"delete"},{default:t(()=>[d(m(a.$t("message.commonBtn.delete")),1)]),_:1})]),_:1})]),default:t(()=>[d(m(a.$t("message.commonBtn.more"))+" ",1)]),_:2},1032,["onCommand"])]),_:1},8,["label"])]),_:1},8,["data"])),[[de,r.tableData.loading]]),o(ie,{onSizeChange:Q,onCurrentChange:W,class:"mt15","pager-count":5,"page-sizes":[10,20,30],"current-page":r.tableData.param.pageNum,"onUpdate:current-page":e[6]||(e[6]=l=>r.tableData.param.pageNum=l),background:"","page-size":r.tableData.param.pageSize,"onUpdate:page-size":e[7]||(e[7]=l=>r.tableData.param.pageSize=l),layout:"total, sizes, prev, pager, next, jumper",total:r.tableData.total},null,8,["current-page","page-size","total"])]),o(p(L),{ref_key:"nsDialogRef",ref:C,onRefresh:e[8]||(e[8]=l=>u())},null,512),o(p(J),{ref_key:"JobDrawerRef",ref:w,onRefresh:e[9]||(e[9]=l=>u())},null,512)])}}});const Qe=De(ke,[["__scopeId","data-v-1bcff738"]]);export{Qe as default};
