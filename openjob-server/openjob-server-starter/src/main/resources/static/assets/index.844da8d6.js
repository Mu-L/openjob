import{_ as ie}from"./preload-helper.101896b7.js";import{u as ue}from"./vue-i18n.cjs.2a00fe88.js";import{g as $}from"./header.9390c1c5.js";import{a as ce,u as R}from"./index.c0f04633.js";import{g as A,a as x}from"./formatTime.b2c6dda0.js";import{c as fe,d as ge,a as _e,b as E,e as be}from"./data.fead2f89.js";import{r as U}from"./index.23f37e21.js";import{J as q}from"./index.f64fca3a.js";import{ay as z}from"./index.e8f4f9cf.js";import{h as P,r as F,ap as ye,K as C,o as we,a9 as m,ac as Ie,j as u,k as D,l as J,D as e,x as o,u as r,F as V,Z as B,B as y,C as g,y as ve,v as h,A as ke}from"./vue.bd0669ce.js";import{_ as he}from"./_plugin-vue_export-helper.c27b6911.js";import"./_commonjsHelpers.35101cd5.js";import"./storage.b628b270.js";import"./request.554ad02f.js";import"./index.23ad033a.js";import"./index.aa7cec2e.js";import"./themeConfig.cb88f033.js";import"./index.f9fbbdc9.js";import"./keepAliveNames.f05bad75.js";import"./routesList.32d6bb58.js";import"./userInfo.f7c9dd73.js";import"./loading.3e617409.js";import"./tagsViewRoutes.054c4a6f.js";import"./index.ee56f1f7.js";const Se={class:"system-role-container layout-padding"},De={class:"system-role-padding layout-padding-auto layout-padding-view"},Te={class:"system-user-search mb15"},xe=P({name:"systemRole"}),ze=P({...xe,setup(Ce){const{t:l}=ue(),N=R(),S=F(),j=ye(()=>ie(()=>import("./drawer.5cf62a1b.js"),["assets/drawer.5cf62a1b.js","assets/preload-helper.101896b7.js","assets/vue.bd0669ce.js","assets/vue-i18n.cjs.2a00fe88.js","assets/_commonjsHelpers.35101cd5.js","assets/data.fead2f89.js","assets/index.f9fbbdc9.js","assets/request.554ad02f.js","assets/storage.b628b270.js","assets/index.23ad033a.js","assets/index.aa7cec2e.js","assets/themeConfig.cb88f033.js","assets/index.f64fca3a.js","assets/index.e8f4f9cf.js","assets/index.ee56f1f7.js","assets/header.9390c1c5.js","assets/index.c0f04633.js"])),L=F(),f=C({appList:[],topicList:[],statusList:[]}),n=C({form:{appId:"",delayId:"",taskId:"",status:"",dateSelect:[null,null]},rules:{name:{required:!0,message:l("message.app.validateName"),pattern:/^[0-9a-zA-Z_.-]*$/,trigger:"blur"}}}),p=C({tableData:{data:[],total:0,loading:!1,param:{pageNum:1,pageSize:20}}});f.statusList=fe();const i=async()=>{p.tableData.loading=!0;let s={namespaceId:$(),appId:n.form.appId,delayId:n.form.delayId,status:n.form.status,taskId:n.form.taskId,beginTime:0,endTime:0,page:p.tableData.param.pageNum,size:p.tableData.param.pageSize};n.form.dateSelect[0]!==null&&(s.beginTime=A(n.form.dateSelect[0])),n.form.dateSelect[1]!==null&&(s.endTime=A(n.form.dateSelect[1]));let t=await N.getList(s);p.tableData.data=[],t.list.forEach(function(d){p.tableData.data.push({id:d.id,namespaceId:d.namespaceId,appId:d.appId,appName:d.appName,status:d.status,failStatus:d.failStatus,delayId:d.delayId,delayName:d.delayName,taskId:d.taskId,topic:d.topic,delayParams:d.delayParams,delayExtra:d.delayExtra,workerAddress:d.workerAddress,createTime:x(d.createTime),executeTime:x(d.executeTime),completeTime:x(d.completeTime)})}),p.tableData.total=t.total,setTimeout(()=>{p.tableData.loading=!1},500)},H=ge(),M=async(s,t)=>{n.form.delayId="";let d=await ce().getList({namespaceId:$(),appId:s,page:1,size:1024});f.topicList=[],d.list.forEach(function(_){f.topicList.push({id:_.id,label:_.topic})}),t&&await i()},T=s=>{!s||s.validate(t=>{if(t)i();else return!1})},O=()=>{n.form.appId="",n.form.delayId="",n.form.status="",n.form.taskId="",n.form.dateSelect=[null,null],i()},Z=s=>{L.value.openDrawer(s)},K=s=>{q.confirm(l("message.delay.instance.stopTitle")+`(${s.taskId})?`,l("message.commonMsg.tip"),{confirmButtonText:l("message.commonBtn.confirm"),cancelButtonText:l("message.commonBtn.cancel"),type:"warning"}).then(async()=>{let t=await N.stop({taskId:s.taskId});if(Number(t.type)>0){z.error(l("message.commonMsg.stopFail"));return}await i(),z.success(l("message.commonMsg.stopSuccess"))}).catch(()=>{})},G=s=>{q.confirm(l("message.delay.instance.deleteTitle")+`(${s.taskId})?`,l("message.commonMsg.tip"),{confirmButtonText:l("message.commonBtn.confirm"),cancelButtonText:l("message.commonBtn.cancel"),type:"warning"}).then(async()=>{await R().delete({taskId:s.taskId}),await i(),z.success(l("message.commonMsg.deleteSuccess"))}).catch(()=>{})},Q=s=>{p.tableData.param.pageSize=s,i()},W=s=>{p.tableData.param.pageNum=s,i()};return we(async()=>{let s=U.currentRoute.value.query.delayId,t=U.currentRoute.value.query.appId;f.appList=await _e(),s!=null&&t!=null&&(await M(Number(t),!1),n.form.appId=Number(t),n.form.delayId=Number(s)),await i()}),(s,t)=>{const d=m("el-option"),_=m("el-select"),w=m("el-form-item"),b=m("el-col"),X=m("el-input"),Y=m("el-date-picker"),ee=m("ele-Search"),I=m("el-icon"),v=m("el-button"),ae=m("ele-RefreshRight"),te=m("el-row"),le=m("el-form"),c=m("el-table-column"),oe=m("el-tag"),se=m("ele-View"),ne=m("ele-Stopwatch"),re=m("ele-Delete"),de=m("el-table"),me=m("el-pagination"),pe=Ie("loading");return u(),D("div",Se,[J("div",De,[J("div",Te,[e(le,{ref_key:"tableSearchRef",ref:S,"label-width":80,model:n.form,rules:n.rules},{default:o(()=>[e(te,null,{default:o(()=>[e(b,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:o(()=>[e(w,{label:r(l)("message.app.name"),prop:"appName"},{default:o(()=>[e(_,{modelValue:n.form.appId,"onUpdate:modelValue":t[0]||(t[0]=a=>n.form.appId=a),filterable:"",placeholder:r(l)("message.commonMsg.all"),size:"default",style:{width:"95%"}},{default:o(()=>[(u(!0),D(V,null,B(f.appList,a=>(u(),h(d,{key:a.id,label:a.label,value:a.id,onClick:k=>M(a.id,!0)},null,8,["label","value","onClick"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(b,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:o(()=>[e(w,{label:r(l)("message.delay.instance.topic"),prop:"topic"},{default:o(()=>[e(_,{modelValue:n.form.delayId,"onUpdate:modelValue":t[2]||(t[2]=a=>n.form.delayId=a),filterable:"",placeholder:r(l)("message.commonMsg.all"),size:"default",style:{width:"90%"}},{default:o(()=>[(u(!0),D(V,null,B(f.topicList,a=>(u(),h(d,{key:a.id,label:a.label,value:a.id,onClick:t[1]||(t[1]=k=>T(S.value))},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(b,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:o(()=>[e(w,{label:r(l)("message.delay.instance.status"),prop:"topic"},{default:o(()=>[e(_,{modelValue:n.form.status,"onUpdate:modelValue":t[4]||(t[4]=a=>n.form.status=a),filterable:"",placeholder:r(l)("message.commonMsg.all"),size:"default",style:{width:"90%"}},{default:o(()=>[(u(!0),D(V,null,B(f.statusList,a=>(u(),h(d,{key:a.id,label:a.label,value:a.id,onClick:t[3]||(t[3]=k=>T(S.value))},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(b,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:o(()=>[e(w,{label:r(l)("message.delay.instance.taskId"),prop:"taskId"},{default:o(()=>[e(X,{modelValue:n.form.taskId,"onUpdate:modelValue":t[5]||(t[5]=a=>n.form.taskId=a),size:"default",style:{width:"95%"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(b,{xs:8,sm:12,md:8,lg:8,xl:6,class:"mb20"},{default:o(()=>[e(w,{label:r(l)("message.dateMsg.rangeMsg"),prop:"taskId"},{default:o(()=>[e(Y,{modelValue:n.form.dateSelect,"onUpdate:modelValue":t[6]||(t[6]=a=>n.form.dateSelect=a),type:"datetimerange",shortcuts:r(H),"range-separator":"-",size:"default","start-placeholder":r(l)("message.dateMsg.startDate"),"end-placeholder":r(l)("message.dateMsg.endDate")},null,8,["modelValue","shortcuts","start-placeholder","end-placeholder"])]),_:1},8,["label"])]),_:1}),e(b,{xs:8,sm:12,md:8,lg:6,xl:4,class:"mb20"},{default:o(()=>[e(v,{size:"default",type:"primary",class:"ml10",onClick:t[7]||(t[7]=a=>T(S.value))},{default:o(()=>[e(I,null,{default:o(()=>[e(ee)]),_:1}),y(" "+g(s.$t("message.commonBtn.query")),1)]),_:1}),e(v,{size:"default",type:"primary",class:"ml10",onClick:t[8]||(t[8]=a=>O())},{default:o(()=>[e(I,null,{default:o(()=>[e(ae)]),_:1}),y(" "+g(s.$t("message.commonBtn.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),ve((u(),h(de,{data:p.tableData.data,style:{width:"100%"}},{default:o(()=>[e(c,{prop:"taskId",label:r(l)("message.delay.instance.taskId"),"show-overflow-tooltip":""},null,8,["label"]),e(c,{prop:"delayName",label:r(l)("message.delay.job.name"),"show-overflow-tooltip":""},null,8,["label"]),e(c,{prop:"topic",label:r(l)("message.delay.instance.topic"),"show-overflow-tooltip":""},null,8,["label"]),e(c,{prop:"status",label:r(l)("message.delay.instance.status"),"show-overflow-tooltip":""},{default:o(a=>[e(oe,{class:"ml-2",type:r(E)(a.row.status).tag},{default:o(()=>[y(g(r(E)(a.row.status).label)+g(r(be)(a.row.failStatus)),1)]),_:2},1032,["type"])]),_:1},8,["label"]),e(c,{prop:"executeTime",label:r(l)("message.delay.instance.executeTime"),"show-overflow-tooltip":""},null,8,["label"]),e(c,{prop:"completeTime",label:r(l)("message.delay.instance.completeTime"),"show-overflow-tooltip":""},null,8,["label"]),e(c,{prop:"createTime",label:r(l)("message.delay.instance.createTime"),"show-overflow-tooltip":""},null,8,["label"]),e(c,{label:r(l)("message.commonMsg.operation"),width:"300"},{default:o(a=>[e(v,{type:"primary",size:"default",onClick:k=>Z(a.row)},{default:o(()=>[e(I,null,{default:o(()=>[e(se)]),_:1}),y(" "+g(s.$t("message.commonBtn.log")),1)]),_:2},1032,["onClick"]),a.row.status===15?(u(),h(v,{key:0,type:"warning",size:"default",onClick:k=>K(a.row)},{default:o(()=>[e(I,null,{default:o(()=>[e(ne)]),_:1}),y(" "+g(s.$t("message.commonBtn.stop")),1)]),_:2},1032,["onClick"])):ke("",!0),e(v,{type:"danger",size:"default",onClick:k=>G(a.row)},{default:o(()=>[e(I,null,{default:o(()=>[e(re)]),_:1}),y(" "+g(s.$t("message.commonBtn.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[pe,p.tableData.loading]]),e(me,{onSizeChange:Q,onCurrentChange:W,class:"mt15","pager-count":5,"page-sizes":[10,20,30],"current-page":p.tableData.param.pageNum,"onUpdate:current-page":t[9]||(t[9]=a=>p.tableData.param.pageNum=a),background:"","page-size":p.tableData.param.pageSize,"onUpdate:page-size":t[10]||(t[10]=a=>p.tableData.param.pageSize=a),layout:"total, sizes, prev, pager, next, jumper",total:p.tableData.total},null,8,["current-page","page-size","total"])]),e(r(j),{ref_key:"JobDrawerRef",ref:L,onRefresh:t[11]||(t[11]=a=>i())},null,512)])}}});const ea=he(ze,[["__scopeId","data-v-682d96ba"]]);export{ea as default};
