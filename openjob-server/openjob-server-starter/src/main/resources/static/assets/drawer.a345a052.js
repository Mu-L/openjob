import{h as z,r as X,K as Y,o as ee,a9 as u,j as c,v as b,x as a,l as V,C as _,D as t,u as n,k as h,Z as v,F as w,y as N,E as U,B as F}from"./vue.bd0669ce.js";import{u as le}from"./vue-i18n.cjs.2a00fe88.js";import{u as ae}from"./index.6abbbed7.js";import{u as te}from"./index.f9fbbdc9.js";import{u as se}from"./index.6b601b7a.js";import{ay as L}from"./index.e8f4f9cf.js";import"./_commonjsHelpers.35101cd5.js";import"./request.554ad02f.js";import"./storage.b628b270.js";import"./index.23ad033a.js";import"./index.aa7cec2e.js";import"./themeConfig.cb88f033.js";import"./index.f64fca3a.js";import"./index.ee56f1f7.js";const re={class:"system-role-dialog-container",style:{padding:"20px"}},oe={style:{flex:"auto","text-align":"left","padding-left":"30px","padding-bottom":"10px"}},ue=z({name:"jobDrawerName"}),xe=z({...ue,emits:["refresh"],setup(me,{expose:j,emit:k}){const{t:o}=le(),q=ae(),A=se(),g=X(),e=Y({isUpdate:!1,dialogTitle:"",rowState:{inputProcessor:!0,inputSecret:!1,btnGenerate:!1},activeTab:1,drawer:{type:"",isShow:!1},events:[{value:"job",label:"定时任务",children:[{value:"alarm.job.001",label:"定时任务-执行失败"},{value:"alarm.job.002",label:"定时任务-任务丢弃"},{value:"alarm.job.003",label:"定时任务-执行超时"}]},{value:"delay",label:"延时任务",children:[{value:"alarm.delay.001",label:"延时任务-执行失败"},{value:"alarm.delay.002",label:"延时任务-执行超时"},{value:"alarm.delay.003",label:"延时任务-任务丢弃"}]}],localeTypes:[{value:"zh_CN",label:"简体中文"},{value:"en_US",label:"English"}],methodTypes:[{value:"webhook",label:"webhook"},{value:"feishu",label:"飞书"},{value:"dingding",label:"钉钉"},{value:"wecom",label:"企微"}],fromRules:{name:{required:!0,message:o("message.alert.name"),trigger:"blur"},status:{required:!0},locale:{required:!0},method:{required:!0},url:{required:!0,message:o("message.alert.url"),trigger:"blur"},secret:{required:!0,message:o("message.alert.secret"),trigger:"blur"},nsAndApp:{required:!0,message:o("message.alert.url"),trigger:"blur"}},namespaceList:[],selectNsAppList:[],ruleForm:{id:0,name:"",locale:"zh_CN",method:"webhook",url:"",secret:"",events:[],selectApps:[],status:!0}});ee(async()=>{await M()});const S=async s=>{let l=await te().getList({namespaceId:s,page:1,size:1024});e.selectNsAppList=[];let d=[];l.list.forEach(function(m){d.push({id:m.id,label:m.name})}),e.selectNsAppList=d},M=async()=>{let s=await q.getList({page:1,size:128});e.namespaceList=[],s.list.forEach(function(l){e.namespaceList.push({id:l.id,name:l.name})})},B=async(s,l)=>{if(e.activeTab=1,e.drawer.type=s,e.drawer.isShow=!0,await S(e.activeTab),s==="add"){e.isUpdate=!1,await R(),e.dialogTitle=o("message.alert.addTitle");return}e.isUpdate=!0,e.dialogTitle=o("message.alert.updateTitle"),await D(l)},R=async()=>{var s;(s=g.value)==null||s.clearValidate(),e.ruleForm.name="",e.ruleForm.selectApps=[],e.ruleForm.events=[],e.ruleForm.locale="zh_CN",e.ruleForm.method="webhook",e.ruleForm.url="",e.ruleForm.secret="",e.ruleForm.status=!0,y(e.ruleForm.method)},D=async s=>{var l;(l=g.value)==null||l.clearValidate(),e.ruleForm.id=s.id,e.ruleForm.name=s.name,e.ruleForm.selectApps=s.namespaceAppIds,e.ruleForm.events=s.events,e.ruleForm.method=s.method,e.ruleForm.locale=s.locale,e.ruleForm.url=s.url,e.ruleForm.secret=s.secret,e.ruleForm.status=s.status,y(e.ruleForm.method)},y=s=>{if(s=="wecom"){e.rowState.inputSecret=!1;return}e.rowState.btnGenerate=s=="webhook",e.rowState.inputSecret=!0},E=()=>{let s=16,l="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789$#@!&",d="";for(let m=0,i=l.length;m<s;++m)d+=l.charAt(Math.floor(Math.random()*i));e.ruleForm.secret=d},I=()=>{e.drawer.isShow=!1},G=async s=>{if(!s)return;let l=["name","url"];e.ruleForm.method!="wecom"&&(l[2]="secret"),await s.validateField(l,d=>{if(d)$();else return!1})},$=async()=>{let s={name:e.ruleForm.name,namespaceAppIds:e.ruleForm.selectApps,events:e.ruleForm.events,metrics:[],locale:e.ruleForm.locale,method:e.ruleForm.method,url:e.ruleForm.url,secret:e.ruleForm.secret,status:e.ruleForm.status?1:2};if(e.drawer.type==="add"){await A.add(s),L.success(o("message.commonMsg.addSuccess")),e.drawer.isShow=!1,k("refresh");return}s.id=e.ruleForm.id,await A.update(s),L.success(o("message.commonMsg.updateSuccess")),e.drawer.isShow=!1,k("refresh")};return j({openDrawer:B}),(s,l)=>{const d=u("el-input"),m=u("el-form-item"),i=u("el-col"),p=u("el-row"),J=u("el-checkbox"),K=u("el-checkbox-group"),P=u("el-tab-pane"),Z=u("el-tabs"),H=u("el-tree-select"),O=u("el-switch"),T=u("el-option"),C=u("el-select"),x=u("el-button"),Q=u("el-form"),W=u("el-drawer");return c(),b(W,{modelValue:e.drawer.isShow,"onUpdate:modelValue":l[11]||(l[11]=r=>e.drawer.isShow=r),direction:"rtl",size:"60%"},{header:a(()=>[V("h4",null,_(e.dialogTitle),1)]),default:a(()=>[V("div",re,[t(Q,{ref_key:"jobFormRef",ref:g,model:e.ruleForm,"label-width":"120px","label-position":"left",rules:e.fromRules,size:"default"},{default:a(()=>[t(p,null,{default:a(()=>[t(i,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:a(()=>[t(m,{label:n(o)("message.alert.name"),prop:"name"},{default:a(()=>[t(d,{modelValue:e.ruleForm.name,"onUpdate:modelValue":l[0]||(l[0]=r=>e.ruleForm.name=r),clearable:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),t(p,null,{default:a(()=>[t(i,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:a(()=>[t(m,{label:n(o)("message.alert.nsAndApp"),prop:"nsAndApp"},{default:a(()=>[t(Z,{modelValue:e.activeTab,"onUpdate:modelValue":l[2]||(l[2]=r=>e.activeTab=r),type:"border-card","tab-position":"top",onTabChange:S,class:"demo-tabs",style:{width:"100%",height:"300px"}},{default:a(()=>[(c(!0),h(w,null,v(e.namespaceList,r=>(c(),b(P,{key:r.id,label:r.name,name:r.id,style:{width:"100%",height:"300px",overflow:"auto"}},{default:a(()=>[t(K,{modelValue:e.ruleForm.selectApps,"onUpdate:modelValue":l[1]||(l[1]=f=>e.ruleForm.selectApps=f)},{default:a(()=>[(c(!0),h(w,null,v(e.selectNsAppList,f=>(c(),b(J,{key:f.id,label:f.id,style:{width:"200px"}},{default:a(()=>[F(_(f.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),t(p,null,{default:a(()=>[t(i,{xs:24,sm:18,md:18,lg:18,xl:18,class:"mb20"},{default:a(()=>[t(m,{label:n(o)("message.alert.events"),prop:"status"},{default:a(()=>[t(H,{modelValue:e.ruleForm.events,"onUpdate:modelValue":l[3]||(l[3]=r=>e.ruleForm.events=r),data:e.events,multiple:"","render-after-expand":!1,"show-checkbox":"",filterable:"","default-expanded-keys":["job","delay"],style:{width:"100%"}},null,8,["modelValue","data"])]),_:1},8,["label"])]),_:1})]),_:1}),t(p,null,{default:a(()=>[t(i,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:a(()=>[t(m,{label:n(o)("message.alert.status"),prop:"status"},{default:a(()=>[t(O,{modelValue:e.ruleForm.status,"onUpdate:modelValue":l[4]||(l[4]=r=>e.ruleForm.status=r),class:"ml-2",name:"status",size:"default",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),t(p,null,{default:a(()=>[t(i,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:a(()=>[t(m,{label:n(o)("message.alert.locale"),prop:"locale"},{default:a(()=>[t(C,{modelValue:e.ruleForm.locale,"onUpdate:modelValue":l[5]||(l[5]=r=>e.ruleForm.locale=r),class:"m-2",placeholder:n(o)("message.commonMsg.emptySelect"),style:{width:"100%"}},{default:a(()=>[(c(!0),h(w,null,v(e.localeTypes,r=>(c(),b(T,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),t(p,null,{default:a(()=>[t(i,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:a(()=>[t(m,{label:n(o)("message.alert.method"),prop:"method"},{default:a(()=>[t(C,{modelValue:e.ruleForm.method,"onUpdate:modelValue":l[6]||(l[6]=r=>e.ruleForm.method=r),class:"m-2",placeholder:n(o)("message.commonMsg.emptySelect"),style:{width:"100%"}},{default:a(()=>[(c(!0),h(w,null,v(e.methodTypes,r=>(c(),b(T,{key:r.value,label:r.label,value:r.value,onClick:f=>y(r.value)},null,8,["label","value","onClick"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),t(p,null,{default:a(()=>[t(i,{xs:24,sm:18,md:18,lg:18,xl:18,class:"mb20"},{default:a(()=>[t(m,{label:n(o)("message.alert.url"),prop:"url"},{default:a(()=>[t(d,{modelValue:e.ruleForm.url,"onUpdate:modelValue":l[7]||(l[7]=r=>e.ruleForm.url=r),clearable:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),N(t(p,null,{default:a(()=>[t(i,{xs:12,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:a(()=>[t(m,{label:n(o)("message.alert.secret"),prop:"secret"},{default:a(()=>[t(d,{modelValue:e.ruleForm.secret,"onUpdate:modelValue":l[8]||(l[8]=r=>e.ruleForm.secret=r),clearable:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),N(t(i,{xs:12,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:a(()=>[t(x,{type:"primary",link:"",size:"default",onClick:l[9]||(l[9]=r=>E()),style:{"margin-left":"10px","margin-top":"6px"}},{default:a(()=>[F(_(n(o)("message.alert.generate")),1)]),_:1})]),_:1},512),[[U,e.rowState.btnGenerate]])]),_:1},512),[[U,e.rowState.inputSecret]])]),_:1},8,["model","rules"])])]),footer:a(()=>[V("div",oe,[t(x,{type:"primary",onClick:l[10]||(l[10]=r=>G(g.value)),size:"default"},{default:a(()=>[F(_(n(o)("message.commonBtn.confirm")),1)]),_:1}),t(x,{onClick:I,size:"default"},{default:a(()=>[F(_(n(o)("message.commonBtn.cancel")),1)]),_:1})])]),_:1},8,["modelValue"])}}});export{xe as default};
