import{_ as h}from"./preload-helper.101896b7.js";import{u as ve}from"./vue-i18n.cjs.2a00fe88.js";import{L as Se}from"./storage.b628b270.js";import{a as Te,u as De}from"./index.26d42108.js";import{g as O,a as R}from"./formatTime.b2c6dda0.js";import{d as Ie,h as xe,a as he,f as q,e as Re}from"./data.fead2f89.js";import{g as je}from"./header.9390c1c5.js";import{h as J,aH as ke,r as D,ap as j,K as z,o as Ve,a9 as d,ac as Be,j as c,k,l as F,D as a,x as s,u as p,F as M,Z as $,B as y,C as g,y as Ce,v as I,A as ze}from"./vue.bd0669ce.js";import{ay as V}from"./index.e8f4f9cf.js";import{J as H}from"./index.f64fca3a.js";import{_ as Me}from"./_plugin-vue_export-helper.c27b6911.js";import"./_commonjsHelpers.35101cd5.js";import"./request.554ad02f.js";import"./index.23ad033a.js";import"./index.aa7cec2e.js";import"./themeConfig.cb88f033.js";import"./index.f9fbbdc9.js";import"./index.ee56f1f7.js";const $e={class:"system-role-container layout-padding"},Ne={class:"system-role-padding layout-padding-auto layout-padding-view"},Ee={class:"system-user-search mb15"},Ae=J({name:"systemRole"}),Le=J({...Ae,setup(Pe){const{t:o}=ve(),K=Ie(),N=ke(),B=De(),x=D(),Z=j(()=>h(()=>import("./drawer-standalone.4230390d.js"),["assets/drawer-standalone.4230390d.js","assets/preload-helper.101896b7.js","assets/vue.bd0669ce.js","assets/vue-i18n.cjs.2a00fe88.js","assets/_commonjsHelpers.35101cd5.js","assets/index.26d42108.js","assets/request.554ad02f.js","assets/storage.b628b270.js","assets/index.23ad033a.js","assets/index.aa7cec2e.js","assets/themeConfig.cb88f033.js","assets/index.f64fca3a.js","assets/index.e8f4f9cf.js","assets/index.ee56f1f7.js","assets/data.fead2f89.js","assets/index.f9fbbdc9.js","assets/header.9390c1c5.js"])),G=j(()=>h(()=>import("./drawer-broadcast.fe8be5f9.js"),["assets/drawer-broadcast.fe8be5f9.js","assets/vue.bd0669ce.js","assets/vue-i18n.cjs.2a00fe88.js","assets/_commonjsHelpers.35101cd5.js","assets/data.fead2f89.js","assets/index.f9fbbdc9.js","assets/request.554ad02f.js","assets/storage.b628b270.js","assets/index.23ad033a.js","assets/index.aa7cec2e.js","assets/themeConfig.cb88f033.js","assets/index.f64fca3a.js","assets/index.e8f4f9cf.js","assets/index.ee56f1f7.js","assets/header.9390c1c5.js"])),Q=j(()=>h(()=>import("./drawer-mapreduce.f8ba2e13.js"),["assets/drawer-mapreduce.f8ba2e13.js","assets/vue.bd0669ce.js","assets/vue-i18n.cjs.2a00fe88.js","assets/_commonjsHelpers.35101cd5.js","assets/data.fead2f89.js","assets/index.f9fbbdc9.js","assets/request.554ad02f.js","assets/storage.b628b270.js","assets/index.23ad033a.js","assets/index.aa7cec2e.js","assets/themeConfig.cb88f033.js","assets/index.f64fca3a.js","assets/index.e8f4f9cf.js","assets/index.ee56f1f7.js","assets/header.9390c1c5.js"])),W=j(()=>h(()=>import("./drawer-sharding.cf60641c.js"),["assets/drawer-sharding.cf60641c.js","assets/vue.bd0669ce.js","assets/vue-i18n.cjs.2a00fe88.js","assets/_commonjsHelpers.35101cd5.js","assets/data.fead2f89.js","assets/index.f9fbbdc9.js","assets/request.554ad02f.js","assets/storage.b628b270.js","assets/index.23ad033a.js","assets/index.aa7cec2e.js","assets/themeConfig.cb88f033.js","assets/index.f64fca3a.js","assets/index.e8f4f9cf.js","assets/index.ee56f1f7.js","assets/header.9390c1c5.js"])),E=D(),A=D(),L=D(),P=D(),f=z({appSelect:[],jobSelect:[],statusSelect:[]}),n=z({form:{appId:"",jobId:"",status:"",id:"",dateSelect:[null,null]},rules:{}}),m=z({tableData:{data:[],total:0,loading:!1,param:{pageNum:1,pageSize:20}}});f.statusSelect=xe();const i=async()=>{m.tableData.loading=!0;let r={namespaceId:Se.get("nid"),appId:n.form.appId,jobId:n.form.jobId,status:n.form.status,id:n.form.id,beginTime:0,endTime:0,page:m.tableData.param.pageNum,size:m.tableData.param.pageSize};n.form.dateSelect[0]!==null&&(r.beginTime=O(n.form.dateSelect[0])),n.form.dateSelect[1]!==null&&(r.endTime=O(n.form.dateSelect[1]));let e=await B.getList(r);m.tableData.data=[],e.list.forEach(function(l){m.tableData.data.push({id:l.id,workflowId:l.workflowId,namespaceId:l.namespaceId,appId:l.appId,jobId:l.jobId,jobName:l.jobName,processorType:l.processorType,processorInfo:l.processorInfo,executeType:l.executeType,paramsType:l.paramsType,params:l.params,extendParamsType:l.extendParamsType,extendParams:l.extendParams,timeExpressionType:l.timeExpressionType,timeExpression:l.timeExpression,executeStrategy:l.executeStrategy,failRetryTimes:l.failRetryTimes,failRetryInterval:l.failRetryInterval,concurrency:l.concurrency,status:l.status,failStatus:l.failStatus,workerAddress:l.workerAddress,executeTime:R(l.executeTime),completeTime:R(l.completeTime),lastReportTime:R(l.lastReportTime),createTime:R(l.createTime)})}),m.tableData.total=e.total,setTimeout(()=>{m.tableData.loading=!1},500)},X=async()=>{},Y=async()=>{},ee=async()=>{},U=async(r,e)=>{n.form.jobId="";let l=await Te().getList({namespaceId:je(),appId:r,page:1,size:1024});f.jobSelect=[],l.list.forEach(function(b){f.jobSelect.push({id:b.id,label:b.name})}),e&&await i()},C=r=>{!r||r.validate(e=>{if(e)i();else return!1})},ae=()=>{n.form.appId="",n.form.jobId="",n.form.status="",n.form.id="",n.form.dateSelect=[null,null],i()},te=(r,e)=>{if(e.executeType=="standalone"){E.value.openDrawer(e);return}if(e.executeType=="broadcast"){L.value.openDrawer(e);return}if(e.executeType=="mapReduce"){P.value.openDrawer(e);return}if(e.executeType=="sharding"){A.value.openDrawer(e);return}V.success("Not supported! type="+e.executeType)},le=r=>{H.confirm(o("message.job.instance.stopTitle")+`(${r.id})?`,o("message.commonMsg.tip"),{confirmButtonText:o("message.commonBtn.confirm"),cancelButtonText:o("message.commonBtn.cancel"),type:"warning"}).then(async()=>{let e=await B.stop({id:r.id});if(Number(e.type)>0){V.error(o("message.commonMsg.stopFail"));return}await i(),V.success(o("message.commonMsg.stopSuccess"))}).catch(()=>{})},oe=r=>{H.confirm(o("message.job.instance.deleteTitle")+`(${r.id})?`,o("message.commonMsg.tip"),{confirmButtonText:o("message.commonBtn.confirm"),cancelButtonText:o("message.commonBtn.cancel"),type:"warning"}).then(async()=>{await B.delete({id:r.id}),await i(),V.success(o("message.commonMsg.deleteSuccess"))}).catch(()=>{})},se=r=>{m.tableData.param.pageSize=r,i()},ne=r=>{m.tableData.param.pageNum=r,i()};return Ve(async()=>{let r=N.currentRoute.value.query.id,e=N.currentRoute.value.query.appId;f.appSelect=await he(),r!=null&&e!=null&&(await U(Number(e),!1),n.form.appId=Number(e),n.form.jobId=Number(r)),await i()}),(r,e)=>{const l=d("el-option"),b=d("el-select"),w=d("el-form-item"),_=d("el-col"),re=d("el-input"),pe=d("el-date-picker"),de=d("ele-Search"),v=d("el-icon"),S=d("el-button"),me=d("ele-RefreshRight"),ie=d("el-row"),ue=d("el-form"),u=d("el-table-column"),ce=d("el-tag"),fe=d("ele-View"),ge=d("ele-Stopwatch"),be=d("ele-Delete"),_e=d("el-table"),ye=d("el-pagination"),we=Be("loading");return c(),k("div",$e,[F("div",Ne,[F("div",Ee,[a(ue,{ref_key:"tableSearchRef",ref:x,model:n.form,rules:n.rules},{default:s(()=>[a(ie,null,{default:s(()=>[a(_,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:s(()=>[a(w,{label:p(o)("message.app.name"),prop:"appId"},{default:s(()=>[a(b,{modelValue:n.form.appId,"onUpdate:modelValue":e[0]||(e[0]=t=>n.form.appId=t),filterable:"",class:"m-2",placeholder:p(o)("message.commonMsg.all"),size:"default",style:{width:"90%"}},{default:s(()=>[(c(!0),k(M,null,$(f.appSelect,t=>(c(),I(l,{key:t.id,label:t.label,value:t.id,onClick:T=>U(t.id,!0)},null,8,["label","value","onClick"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(_,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:s(()=>[a(w,{label:p(o)("message.job.job.name"),prop:"jobId"},{default:s(()=>[a(b,{modelValue:n.form.jobId,"onUpdate:modelValue":e[2]||(e[2]=t=>n.form.jobId=t),filterable:"",placeholder:p(o)("message.commonMsg.all"),size:"default",style:{width:"90%"}},{default:s(()=>[(c(!0),k(M,null,$(f.jobSelect,t=>(c(),I(l,{key:t.id,label:t.label,value:t.id,onClick:e[1]||(e[1]=T=>C(x.value))},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(_,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:s(()=>[a(w,{label:p(o)("message.job.job.status"),prop:"status"},{default:s(()=>[a(b,{modelValue:n.form.status,"onUpdate:modelValue":e[4]||(e[4]=t=>n.form.status=t),filterable:"",placeholder:p(o)("message.commonMsg.all"),size:"default",style:{width:"90%"}},{default:s(()=>[(c(!0),k(M,null,$(f.statusSelect,t=>(c(),I(l,{key:t.id,label:t.label,value:t.id,onClick:e[3]||(e[3]=T=>C(x.value))},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(_,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:s(()=>[a(w,{label:p(o)("message.job.instance.id"),prop:"id"},{default:s(()=>[a(re,{modelValue:n.form.id,"onUpdate:modelValue":e[5]||(e[5]=t=>n.form.id=t),size:"default",style:{width:"95%"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),a(_,{xs:8,sm:12,md:8,lg:8,xl:6,class:"mb20"},{default:s(()=>[a(w,{label:p(o)("message.dateMsg.rangeMsg"),prop:"taskId"},{default:s(()=>[a(pe,{modelValue:n.form.dateSelect,"onUpdate:modelValue":e[6]||(e[6]=t=>n.form.dateSelect=t),type:"datetimerange",shortcuts:p(K),"range-separator":"-",size:"default","start-placeholder":p(o)("message.dateMsg.startDate"),"end-placeholder":p(o)("message.dateMsg.endDate")},null,8,["modelValue","shortcuts","start-placeholder","end-placeholder"])]),_:1},8,["label"])]),_:1}),a(_,{xs:8,sm:12,md:8,lg:6,xl:4,class:"mb20"},{default:s(()=>[a(S,{size:"default",type:"primary",class:"ml10",onClick:e[7]||(e[7]=t=>C(x.value))},{default:s(()=>[a(v,null,{default:s(()=>[a(de)]),_:1}),y(" "+g(r.$t("message.commonBtn.query")),1)]),_:1}),a(S,{size:"default",type:"primary",class:"ml10",onClick:e[8]||(e[8]=t=>ae())},{default:s(()=>[a(v,null,{default:s(()=>[a(me)]),_:1}),y(" "+g(r.$t("message.commonBtn.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),Ce((c(),I(_e,{data:m.tableData.data,style:{width:"100%"}},{default:s(()=>[a(u,{prop:"id",label:p(o)("message.job.instance.id"),"show-overflow-tooltip":""},null,8,["label"]),a(u,{prop:"jobName",label:p(o)("message.job.job.name"),"show-overflow-tooltip":""},null,8,["label"]),a(u,{prop:"status",label:p(o)("message.job.instance.status"),"show-overflow-tooltip":""},{default:s(t=>[a(ce,{class:"ml-2",type:p(q)(t.row.status).tag},{default:s(()=>[y(g(p(q)(t.row.status).label)+g(p(Re)(t.row.failStatus)),1)]),_:2},1032,["type"])]),_:1},8,["label"]),a(u,{prop:"workerAddress",label:p(o)("message.job.instance.workerAddress"),"show-overflow-tooltip":""},null,8,["label"]),a(u,{prop:"executeTime",label:p(o)("message.job.instance.executeTime"),"show-overflow-tooltip":""},null,8,["label"]),a(u,{prop:"completeTime",label:p(o)("message.job.instance.completeTime"),"show-overflow-tooltip":""},null,8,["label"]),a(u,{prop:"lastReportTime",label:p(o)("message.job.instance.lastReportTime"),"show-overflow-tooltip":""},null,8,["label"]),a(u,{prop:"createTime",label:p(o)("message.job.instance.createTime"),"show-overflow-tooltip":""},null,8,["label"]),a(u,{label:p(o)("message.commonMsg.operation"),width:"300"},{default:s(t=>[a(S,{type:"primary",size:"default",onClick:T=>te("update",t.row)},{default:s(()=>[a(v,null,{default:s(()=>[a(fe)]),_:1}),y(" "+g(r.$t("message.commonBtn.log")),1)]),_:2},1032,["onClick"]),t.row.status===5?(c(),I(S,{key:0,type:"warning",size:"default",onClick:T=>le(t.row)},{default:s(()=>[a(v,null,{default:s(()=>[a(ge)]),_:1}),y(" "+g(r.$t("message.commonBtn.stop")),1)]),_:2},1032,["onClick"])):ze("",!0),a(S,{type:"danger",size:"default",onClick:T=>oe(t.row)},{default:s(()=>[a(v,null,{default:s(()=>[a(be)]),_:1}),y(" "+g(r.$t("message.commonBtn.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[we,m.tableData.loading]]),a(ye,{onSizeChange:se,onCurrentChange:ne,class:"mt15","pager-count":5,"page-sizes":[10,20,30],"current-page":m.tableData.param.pageNum,"onUpdate:current-page":e[9]||(e[9]=t=>m.tableData.param.pageNum=t),background:"","page-size":m.tableData.param.pageSize,"onUpdate:page-size":e[10]||(e[10]=t=>m.tableData.param.pageSize=t),layout:"total, sizes, prev, pager, next, jumper",total:m.tableData.total},null,8,["current-page","page-size","total"])]),a(p(Z),{ref_key:"StandaloneDrawerRef",ref:E,onRefresh:e[11]||(e[11]=t=>i())},null,512),a(p(G),{ref_key:"BroadcastDrawerRef",ref:L,onRefresh:e[12]||(e[12]=t=>X())},null,512),a(p(Q),{ref_key:"MapReduceDrawerRef",ref:P,onRefresh:e[13]||(e[13]=t=>Y())},null,512),a(p(W),{ref_key:"ShardingDrawerRef",ref:A,onRefresh:e[14]||(e[14]=t=>ee())},null,512)])}}});const sa=Me(Le,[["__scopeId","data-v-2ad2bc69"]]);export{sa as default};
